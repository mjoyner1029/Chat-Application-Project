<!-- public/index.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Chat</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #chat { max-width: 600px; margin: auto; }
        #messages { list-style-type: none; padding: 0; }
        #messages li { padding: 8px; border-bottom: 1px solid #ddd; }
        #messageInput { width: calc(100% - 60px); padding: 10px; }
        #sendButton { padding: 10px; }
        .editButton, .deleteButton { margin-left: 10px; }
    </style>
</head>
<body>
    <div id="chat">
        <ul id="messages"></ul>
        <input id="messageInput" autocomplete="off" />
        <button id="sendButton">Send</button>
    </div>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const roomName = urlParams.get('room') || 'default';
        const ws = new WebSocket(`ws://localhost:8080/${roomName}`);
        const messages = document.getElementById('messages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');

        ws.onopen = () => console.log('Connected to WebSocket server');
        ws.onmessage = event => {
            const data = JSON.parse(event.data);
            const li = document.createElement('li');
            li.textContent = data.message || data.newMessage;

            // Create edit button
            if (data.type === 'edit') {
                li.textContent = `Edited: ${data.newMessage}`;
            }
            const editButton = document.createElement('button');
            editButton.className = 'editButton';
            editButton.textContent = 'Edit';
            editButton.onclick = () => {
                const newMessage = prompt('Edit your message:', data.message || data.newMessage);
                if (newMessage) {
                    ws.send(JSON.stringify({ type: 'edit', oldMessage: data.message || data.newMessage, newMessage }));
                }
            };

            // Create delete button
            const deleteButton = document.createElement('button');
            deleteButton.className = 'deleteButton';
            deleteButton.textContent = 'Delete';
            deleteButton.onclick = () => {
                ws.send(JSON.stringify({ type: 'delete', message: data.message || data.newMessage }));
            };

            li.appendChild(editButton);
            li.appendChild(deleteButton);
            messages.appendChild(li);
        };

        ws.onclose = () => console.log('Disconnected from WebSocket server');

        sendButton.onclick = () => {
            const message = messageInput.value;
            ws.send(JSON.stringify({ type: 'message', message }));
            messageInput.value = '';
        };
    </script>
</body>
</html>
